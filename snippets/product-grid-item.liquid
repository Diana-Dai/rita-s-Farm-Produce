<style>
    .product-tile__message {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    text-align: center;
    overflow: hidden;
  }
  .product-tile__message__text {
      position: relative;
      padding: 0;
      margin-top: calc(50% - 14px);
      height: 42px;
      width: 100%;
      font-size: 1.25rem;
      line-height: 1.25em;
      letter-spacing: .2px;
      text-transform: none;
      font-size: 18px;
      text-shadow: 0 0 6px rgba(0,0,0,.9);
      color: #fff;
      user-select: none;
  }
  .product-is-in-basket .product-tile__product-photo-tinter,
  .product-tile__product-photo-tinter.sold-out{
    background-color: rgba(0,0,0,.7);
  }
  .product-tile__product-photo-tinter{
    background-color: rgba(0,0,0,0);
    position: absolute;
    right: 0;
    top: 0;
    height: 100%;
    width: 100%;
    pointer-events: none;
    transition: background-color .2s ease-in-out;
  }
  .grid-product-visuals{
    position: relative;
  }
</style>
{% capture form_id %}AddToCartForm-{{ section_id }}{% endcapture %}
{% unless grid_item_width %}
  {%- assign grid_item_width = 'medium-up--one-quarter small--one-half' -%}
{% endunless %}

{% assign on_sale = false %}
{% if product.compare_at_price > product.price %}
  {%- assign on_sale = true -%}
{% endif %}

{%- assign sold_out = true -%}
{% if product.available %}
  {%- assign sold_out = false -%}
{% endif %}

{%- assign product_tags = product.tags | join: ',' -%}
{%- assign has_custom_label = false -%}
{% if product_tags contains '_label_' %}
  {% for tag in product.tags %}
    {% if tag contains '_label_' %}
      {%- assign tag_starts_with = tag | slice: 0 -%}
      {% if tag_starts_with == '_' %}
        {%- assign has_custom_label = true -%}
        {%- assign custom_label = tag | replace: '_label_', '' -%}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}

<div class="grid__item grid-product {{ grid_item_width }}{% if settings.quick_shop_enable and sold_out == false %} grid-product__has-quick-shop{% endif %}" data-aos="row-of-{{ per_row }}">
  <div class="grid-product__content">
    {% if has_custom_label %}
      <div class="grid-product__tag grid-product__tag--custom">
        {{ custom_label }}
      </div>
    {% else %}
      {% if on_sale and sold_out == false %}
        {% if settings.product_save_amount %}
          <div class="grid-product__tag grid-product__tag--sale">
            {% if settings.product_save_type == 'dollar' %}
              {% capture saved_amount %}{{ product.compare_at_price | minus: product.price | money }}{% endcapture %}
            {% else %}
              {% capture saved_amount %}{{ product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round }}%{% endcapture %}
            {% endif %}
            {{ 'products.general.save_html' | t: saved_amount: saved_amount }}
          </div>
        {% endif %}
      {% endif %}
    {% endif %}
    {% if settings.quick_shop_enable and sold_out == false %}
      <div class="quick-product__btn js-modal-open-quick-modal-{{ product.id }} small--hide" data-product-id="{{ product.id }}">
        <span class="quick-product__label">{{ settings.quick_shop_text }}</span>
      </div>
    {% endif %}

    {%- assign fixed_aspect_ratio = false -%}
    {% unless settings.product_grid_image_size == 'natural' %}
      {%- assign fixed_aspect_ratio = true -%}
    {% endunless %}

    {%- assign preview_image = product.featured_media.preview_image -%}
    {%- assign img_url = preview_image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}

    <div class="grid-product-visuals">
      <a href="{{ product.url | within: collection }}" class="grid-product__link">
        <div class="grid-product__image-mask">
          {% if fixed_aspect_ratio %}
            <div
              class="grid__image-ratio grid__image-ratio--{{ settings.product_grid_image_size }} lazyload"
              data-bgset="{% include 'bgset', image: preview_image %}"
              data-sizes="auto">
            </div>
          {% else %}
            <div class="image-wrap"
              style="height: 0; padding-bottom: {{ 100 | divided_by: preview_image.aspect_ratio }}%;"
              >
              {%- assign img_url = preview_image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}
              <img class="grid-product__image lazyload"
                  data-src="{{ img_url }}"
                  data-widths="[180, 360, 540, 720, 900, 1080]"
                  data-aspectratio="{{ preview_image.aspect_ratio }}"
                  data-sizes="auto"
                  alt="{{ preview_image.alt | escape }}">
              <noscript>
                <img class="grid-product__image lazyloaded"
                  src="{{ preview_image | img_url: '400x' }}"
                  alt="{{ preview_image.alt | escape }}">
              </noscript>
            </div>
          {% endif %}
  
          {% unless sold_out %}
            {% if settings.product_hover_image and product.images.size > 1 %}
              {% for image in product.images offset: 1 limit: 1 %}
                {%- assign second_image = image -%}
              {% endfor %}
              <div
                class="grid-product__secondary-image small--hide lazyload"
                data-bgset="{% include 'bgset', image: second_image %}"
                data-sizes="auto">
              </div>
            {% endif %}
          {% endunless %}
          <div class="product-tile__product-photo-tinter {% if sold_out %}sold-out  {% endif %}"></div>
            {% if sold_out %}
              <div class="product-tile__message">
                <div class="product-tile__message__text">
                  {{ 'products.product.sold_out' | t }}
                </div>
              </div>
            {% endif %}
        </div>
      </a>
      {% include 'customcartbutton', section_id: product.selected_or_first_available_variant.id %}
    </div>
    <div class="grid-product__meta">
      <div class="grid-product__title">{{ product.title }}</div>
      {% if settings.vendor_enable %}
        <div class="grid-product__vendor">{{ product.vendor }}</div>
      {% endif %}
      <div class="grid-product__price">
        {% if on_sale %}
          <span class="visually-hidden">{{ 'products.general.regular_price' | t }}</span>
          <span class="grid-product__price--original">{{ product.compare_at_price | money }}</span>
          <span class="visually-hidden">{{ 'products.general.sale_price' | t }}</span>
        {% endif %}
        {% if product.price_varies %}
          {% assign price = product.price_min | money %}
          <span {% if on_sale %}class="sale-price"{% endif %}>
            {{ 'products.general.from_text_html' | t: price: price }}
          </span>
        {% else %}
          <span {% if on_sale %}class="sale-price"{% endif %}>
            {{ product.price  | money }}
          </span>
        {% endif %}

        {%- assign product_variant = product.selected_or_first_available_variant -%}
        {%- if product_variant.unit_price_measurement -%}
          <div class="product__unit-price">
            {%- capture unit_price_base_unit -%}
              {%- if product_variant.unit_price_measurement -%}
                {%- if product_variant.unit_price_measurement.reference_value != 1 -%}
                  {{ product_variant.unit_price_measurement.reference_value }}
                {%- endif -%}
                {{ product_variant.unit_price_measurement.reference_unit }}
              {%- endif -%}
            {%- endcapture -%}

            {{ product_variant.unit_price | money }}/{{ unit_price_base_unit }}
          </div>
        {%- endif -%}
      </div>
      {% if settings.enable_product_reviews %}
        <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
      {% endif %}
    </div>
   	
    {% comment %}
   <input type="number" class="add_qty" />
   <input type="button" v_id="{{ product.variants.first.id }}" value="Add to cart" class="add_to_cart" />
   {% endcomment %}
   {% comment %}
<!--     <form action="/cart/add" method="post" 'product', product, data-productid: product.id, id: form_id, class: 'product-single__form'>
    {% if product.variants.size == 1 %}
    <input type="hidden" name="id" value="{{ product.variants.first.id }}" />
    {% else %}
    <select name="id">{% for variant in product.variants %}<option value="{{ variant.id }}">{{ variant.title }}</option>{% endfor %}</select>
    {% endif %}
    <div><button type="submit" name="add" class="newBtn ajax_cart add-to-cart">Add to cart<svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-bag" viewBox="0 0 64 64"><g fill="none" stroke="#000" stroke-width="2"><path d="M25 26c0-15.79 3.57-20 8-20s8 4.21 8 20"/><path d="M14.74 18h36.51l3.59 36.73h-43.7z"/></g></svg>
        </button></div>  
</form> -->
    {% endcomment %} 
    
    {% if settings.collection_color_swatches %}
      {%- assign swatch_trigger = 'products.general.color_swatch_trigger' | t | downcase-%}
      {%- assign swatch_file_extension = 'png' -%}

      {% for option in product.options_with_values %}
        {%- assign option_name = option.name | downcase -%}
        {%- assign is_color = false -%}
        {% if option_name contains swatch_trigger %}
          {% assign is_color = true %}
        {%- elsif swatch_trigger == 'color' and option_name contains 'colour' -%}
          {% assign is_color = true %}
        {% endif %}
        {%- if is_color -%}
          {%- assign option_index = forloop.index0 -%}
          {%- assign values = '' -%}
          <div class="grid-product__colors">
            {% for variant in product.variants %}
              {%- assign value = variant.options[option_index] %}
              {% unless values contains value %}
                {%- assign values = values | join: ',' %}
                {%- assign values = values | append: ',' | append: value %}
                {%- assign values = values | split: ',' %}

                {%- assign color_image = value | handle | append: '.' | append: swatch_file_extension | asset_img_url: '50x' | prepend: 'https:' | split: '?' | first -%}
                {%- assign color_swatch_fallback = value | split: ' ' | last | handle -%}

                <a
                  href="{{ variant.url | within: collection }}"
                  class="color-swatch color-swatch--small"
                  style="background-image: url({{ color_image }}); background-color: {{ color_swatch_fallback }};">
                </a>
              {% endunless %}
             {% endfor %}
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}
  </div>
</div>
